<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <title>æµ·é¾Ÿæ±¤ Â· Turtle Soup AI</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px }
        .card { background:white; padding:20px; border-radius:8px; max-width:700px; margin:auto }
        h1 { margin-top:0 }
        textarea { width:100%; height:80px }
        button { margin-top:10px; padding:8px 16px }
        .log { margin-top:20px; background:#fafafa; padding:10px; border:1px solid #ddd; height:200px; overflow:auto }
    </style>
</head>
<body>
<div class="card">
    <h1>æµ·é¾Ÿæ±¤æ¸¸æˆ</h1>
    <p><strong>æ±¤é¢ï¼š</strong></p>
    <p id="soupSurface">åŠ è½½ä¸­...</p>

    <label for="question">é—®é¢˜ï¼š</label>
    <textarea id="question" placeholder="è¯·è¾“å…¥ä½ çš„é—®é¢˜"></textarea><br/>
    <button onclick="ask()">æé—®</button>
    <button onclick="giveUp()">æ”¾å¼ƒ</button>
    <button onclick="newGame()">æ–°çš„ä¸€å±€</button>
    <button onclick="guess()">æˆ‘çŸ¥é“ç­”æ¡ˆäº†</button>

    <div class="log" id="log"></div>
</div>

<!-- èƒœåˆ©å¼¹çª—ï¼ˆé»˜è®¤éšè—ï¼‰ -->
<div id="winModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
    <div style="background:#fff; width:300px; margin:100px auto; padding:20px; text-align:center;">
        <h2>ğŸ‰ æ­å–œèƒœåˆ©ï¼</h2>
        <p>ä½ æˆåŠŸå¤ç›˜äº†çœŸç›¸ã€‚</p>
        <button onclick="newGame()">æ–°çš„ä¸€å±€</button>
        <button onclick="viewHistory()">å†å²å›é¡¾</button>
    </div>
</div>

<!-- å–å®Œæ‰€æœ‰æ±¤å¼¹çª— -->
<div id="endModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
    <div style="background:#fff; width:320px; margin:100px auto; padding:20px; text-align:center;">
        <h2>ğŸ¥³ å…¨éƒ¨å–å®Œå•¦ï¼</h2>
        <p>ä½ å·²ç»ä½“éªŒäº†æ‰€æœ‰æµ·é¾Ÿæ±¤é¢˜ç›®ã€‚</p>
        <button onclick="closeEndModal()">ç¡®å®š</button>
        <button onclick="restartAll()">é‡æ–°æ¥ä¸€è½®</button>
    </div>
</div>

<script>
    function log(text) {
        const div = document.getElementById('log');
        div.innerHTML += text + '<br/>';
        div.scrollTop = div.scrollHeight;
    }

    function loadStart() {
        fetch('/game/start')
            .then(r => r.text())
            .then(t => {
                if (t.includes("å–å®Œ")) {
                  showEndModal();
                   document.getElementById('soupSurface').innerText = "æ‰€æœ‰é¢˜ç›®å·²å®Œæˆ";
                   return;
                }
                document.getElementById('soupSurface').innerText = t;
                document.getElementById('log').innerHTML = '';
                log('æ¸¸æˆå¼€å§‹');
            });
    }

    function ask() {
        const q = document.getElementById('question').value;
        if (!q) return;

        fetch('/game/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'question=' + encodeURIComponent(q)
        })
        .then(r => r.text())
        .then(a => {
            log('Q: ' + q);
            log('A: ' + a);
            document.getElementById('question').value = '';
        });
    }

    function giveUp() {
        fetch('/game/giveup', { method: 'POST' })
            .then(r => r.text())
            .then(t => {
                log('æ”¾å¼ƒï¼Œæ±¤åº•ï¼š' + t);
            });
    }

    function newGame() {
        fetch('/game/new', { method: 'POST' })
            .then(r => r.text())
            .then(t => {
                if (t.includes("å–å®Œ")) {
                  showEndModal();
                  return;
                }
                document.getElementById('soupSurface').innerText = t;
                document.getElementById('log').innerHTML = '';
                document.getElementById('winModal').style.display = "none";
                log('æ–°çš„ä¸€å±€å¼€å§‹');
            });
    }

    function guess() {
        const statement = document.getElementById('question').value;
        if (!statement) return;

        fetch('/game/guess', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'statement=' + encodeURIComponent(statement)
        })
        .then(res => res.text())
        .then(result => {
            log('Q(çŒœæµ‹): ' + statement);
            if (result === "WIN") {
                showWinModal(); // æ˜¾ç¤ºèƒœåˆ©å¼¹çª—
            } else {
                log('A: è¿˜æ²¡å®Œå…¨å¯¹ï¼Œå†æƒ³æƒ³å§ã€‚');
            }
            document.getElementById('question').value = '';
        });
    }

    function showWinModal() {
        document.getElementById('winModal').style.display = "block";
        log('ğŸ‰ æ­å–œèƒœåˆ©ï¼');
    }

    function viewHistory() {
        alert("ğŸ¢ å†å²å›é¡¾åŠŸèƒ½å³å°†ä¸Šçº¿ï¼");
    }

    function showEndModal() {
        document.getElementById('endModal').style.display = "block";
    }

    function closeEndModal() {
        document.getElementById('endModal').style.display = "none";
    }

    function restartAll() {
        fetch('/game/reset', { method: 'POST' })
            .then(() => {
                document.getElementById('endModal').style.display = "none";
                loadStart();
            });
    }


    loadStart();
</script>
</body>
</html>
